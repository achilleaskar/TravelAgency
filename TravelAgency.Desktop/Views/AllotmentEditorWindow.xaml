<!-- Desktop/Views/AllotmentEditorWindow.xaml -->
<Window x:Class="TravelAgency.Desktop.Views.AllotmentEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Allotment"
        Width="1000"
        Height="720"
        Background="White"
        WindowStartupLocation="CenterOwner">
    <DockPanel>
        <TabControl Margin="16">
            <!-- Main -->
            <TabItem Header="Main">
                <Grid Margin="8"
                      ColumnDefinitions="160,*,160,*"
                      RowDefinitions="Auto,8,Auto,8,Auto,8,Auto,8,Auto,*,Auto">
                    <TextBlock Text="Hotel"
                               Grid.Row="0"
                               Grid.Column="0"
                               VerticalAlignment="Center" />
                    <ComboBox Grid.Row="0"
                              Grid.Column="1"
                              ItemsSource="{Binding Hotels}"
                              DisplayMemberPath="Name"
                              SelectedItem="{Binding SelectedHotel}" />
                    <TextBlock Text="Title"
                               Grid.Row="2"
                               Grid.Column="0"
                               VerticalAlignment="Center" />
                    <TextBox Grid.Row="2"
                             Grid.Column="1"
                             Text="{Binding Title, UpdateSourceTrigger=PropertyChanged}" />
                    <TextBlock Text="Start Date"
                               Grid.Row="4"
                               Grid.Column="0"
                               VerticalAlignment="Center" />
                    <DatePicker Grid.Row="4"
                                Grid.Column="1"
                                SelectedDate="{Binding StartDate}" />
                    <TextBlock Text="End Date"
                               Grid.Row="6"
                               Grid.Column="0"
                               VerticalAlignment="Center" />
                    <DatePicker Grid.Row="6"
                                Grid.Column="1"
                                SelectedDate="{Binding EndDate}" />
                    <TextBlock Text="Option Due"
                               Grid.Row="0"
                               Grid.Column="2"
                               VerticalAlignment="Center" />
                    <DatePicker Grid.Row="0"
                                Grid.Column="3"
                                SelectedDate="{Binding OptionDueDate}" />
                    <TextBlock Text="Status"
                               Grid.Row="2"
                               Grid.Column="2"
                               VerticalAlignment="Center" />
                    <ComboBox Grid.Row="2"
                              Grid.Column="3"
                              SelectedItem="{Binding Status}"
                              ItemsSource="{Binding Source={x:Static sys:Enum.GetValues}, 
                                            ConverterParameter={x:Type enums:AllotmentStatus}}">
                        <ComboBox.Resources>
                            <ObjectDataProvider x:Key="statusValues"
                                                MethodName="GetValues"
                                                ObjectType="{x:Type sys:Enum}">
                                <ObjectDataProvider.MethodParameters>
                                    <x:Type TypeName="enums:AllotmentStatus" />
                                </ObjectDataProvider.MethodParameters>
                            </ObjectDataProvider>
                        </ComboBox.Resources>
                    </ComboBox>
                    <TextBlock Text="Date Policy"
                               Grid.Row="4"
                               Grid.Column="2"
                               VerticalAlignment="Center" />
                    <ComboBox Grid.Row="4"
                              Grid.Column="3"
                              SelectedItem="{Binding DatePolicy}">
                        <ComboBoxItem Content="ExactDates" />
                        <ComboBoxItem Content="PartialAllowed" />
                    </ComboBox>
                    <TextBlock Text="Notes"
                               Grid.Row="8"
                               Grid.Column="0"
                               VerticalAlignment="Top" />
                    <TextBox Grid.Row="8"
                             Grid.Column="1"
                             Grid.ColumnSpan="3"
                             AcceptsReturn="True"
                             Height="100"
                             Text="{Binding Notes}" />
                </Grid>
            </TabItem>
            <!-- Room Types -->
            <TabItem Header="Room Types">
                <DockPanel Margin="8">
                    <ToolBar DockPanel.Dock="Top">
                        <Button Content="Add Line"
                                Command="{Binding NewLineCommand}" />
                        <Button Content="Remove"
                                Command="{Binding RemoveLineCommand}" />
                        <Separator />
                        <TextBlock Text="Nights:"
                                   Margin="8,0,4,0"
                                   VerticalAlignment="Center" />
                        <TextBlock Text="{Binding Nights}"
                                   FontWeight="Bold"
                                   VerticalAlignment="Center" />
                    </ToolBar>
                    <DataGrid ItemsSource="{Binding Lines}"
                              SelectedItem="{Binding SelectedLine}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Margin="0,8,0,0">
                        <DataGrid.Columns>
                            <DataGridComboBoxColumn Header="Room Type"
                                                    Width="220"
                                                    SelectedItemBinding="{Binding RoomType, UpdateSourceTrigger=PropertyChanged}"
                                                    DisplayMemberPath="Name"
                                                    ItemsSource="{Binding DataContext.RoomTypes, RelativeSource={RelativeSource AncestorType=Window}}" />
                            <DataGridTextColumn Header="Qty"
                                                Binding="{Binding Quantity}"
                                                Width="80" />
                            <DataGridTextColumn Header="Price"
                                                Binding="{Binding PricePerNight, StringFormat={}{0:0.##}}"
                                                Width="100" />
                            <DataGridTextColumn Header="Currency"
                                                Binding="{Binding Currency}"
                                                Width="90" />
                            <DataGridTextColumn Header="Notes"
                                                Binding="{Binding Notes}"
                                                Width="*" />
                            <DataGridTextColumn Header="Line Total"
                                                Binding="{Binding Path=DataContext.Nights, RelativeSource={RelativeSource AncestorType=Window},
                                                                  Converter={StaticResource MultiplyConverter}, 
                                                                  ConverterParameter={Binding PricePerNight, RelativeSource={RelativeSource Self}}}"
                                                Visibility="Collapsed" />
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
            <!-- Payments -->
            <TabItem Header="Payments">
                <DockPanel Margin="8">
                    <ToolBar DockPanel.Dock="Top">
                        <Button Content="Add Payment"
                                Command="{Binding NewPaymentCommand}" />
                        <Button Content="Remove"
                                Command="{Binding RemovePaymentCommand}" />
                    </ToolBar>
                    <DataGrid ItemsSource="{Binding Payments}"
                              SelectedItem="{Binding SelectedPayment}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Margin="0,8,0,0">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Date"
                                                Binding="{Binding Date, StringFormat=\{0:yyyy-MM-dd\}}"
                                                Width="130" />
                            <DataGridTextColumn Header="Title"
                                                Binding="{Binding Title}"
                                                Width="*" />
                            <DataGridTextColumn Header="Kind"
                                                Binding="{Binding Kind}"
                                                Width="120" />
                            <DataGridTextColumn Header="Amount"
                                                Binding="{Binding Amount, StringFormat={}{0:0.##}}"
                                                Width="120" />
                            <DataGridTextColumn Header="Curr"
                                                Binding="{Binding Currency}"
                                                Width="70" />
                            <DataGridTextColumn Header="Notes"
                                                Binding="{Binding Notes}"
                                                Width="*" />
                            <DataGridCheckBoxColumn Header="Voided"
                                                    Binding="{Binding IsVoided}"
                                                    Width="90" />
                        </DataGrid.Columns>
                    </DataGrid>
                </DockPanel>
            </TabItem>
            <!-- Summary -->
            <TabItem Header="Summary">
                <StackPanel Margin="16">
                    <TextBlock Text="Totals"
                               FontWeight="Bold"
                               FontSize="16"
                               Margin="0,0,0,8" />
                    <UniformGrid Columns="2"
                                 Rows="3"
                                 Margin="0,0,0,16">
                        <TextBlock Text="Nights:" />
                        <TextBlock Text="{Binding Nights}"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="Base Cost:" />
                        <TextBlock Text="{Binding BaseCost, StringFormat={}{0:0.##}}"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="Paid:" />
                        <TextBlock Text="{Binding PaidTotal, StringFormat={}{0:0.##}}"
                                   FontWeight="SemiBold" />
                        <TextBlock Text="Balance:" />
                        <TextBlock Text="{Binding Balance, StringFormat={}{0:0.##}}"
                                   FontWeight="Bold" />
                    </UniformGrid>
                    <StackPanel Orientation="Horizontal"
                                HorizontalAlignment="Right">
                        <Button Content="Save"
                                Command="{Binding SaveCommand}"
                                Width="100" />
                        <Button Content="Cancel"
                                Command="{Binding CancelCommand}"
                                Width="100"
                                Margin="8,0,0,0" />
                    </StackPanel>
                </StackPanel>
            </TabItem>
            <!-- History -->
            <TabItem Header="History">
                <!-- Μπορούμε να φέρουμε UpdateLogs αργότερα (όταν θες) -->
                <TextBlock Margin="16"
                           Text="History will list UpdateLogs per field change (Allotment and Lines)." />
            </TabItem>
        </TabControl>
    </DockPanel>
</Window>
