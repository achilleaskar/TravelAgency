<UserControl x:Class="TravelAgency.Desktop.Views.AllotmentsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
            Background="White" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
    <DockPanel>

        <!-- Toolbar -->
        <Grid DockPanel.Dock="Top"
              Margin="8,6,8,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="160" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>

            <TextBlock Grid.Column="0"
                       Text="Search"
                       Style="{StaticResource FormLabel}" />
            <TextBox   Grid.Column="1"
                       Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                       Style="{StaticResource FormControl}" />

            <TextBlock Grid.Column="3"
                       Text="Hotel"
                       Style="{StaticResource FormLabel}" />
            <ComboBox  Grid.Column="4"
                       ItemsSource="{Binding Hotels}"
                       DisplayMemberPath="Name"
                       SelectedItem="{Binding FilterHotel}"
                       Style="{StaticResource FormControl}" />

            <TextBlock Grid.Column="6"
                       Text="Status"
                       Style="{StaticResource FormLabel}" />
            <ComboBox  Grid.Column="7"
                       ItemsSource="{Binding Statuses}"
                       SelectedItem="{Binding FilterStatus}"
                       Style="{StaticResource FormControl}" />

            <Button Grid.Column="9"
                    Content="Refresh"
                    Command="{Binding LoadCommand}"
                    Style="{StaticResource FormControl}" />
        </Grid>

        <!-- Master / Detail -->
        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>

            <DataGrid Grid.Column="0"
                      ItemsSource="{Binding Allotments}"
                      SelectedItem="{Binding Selected}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True">
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <!-- grey out exhausted allotments -->
                            <DataTrigger Binding="{Binding RemainingTotal}"
                                         Value="0">
                                <Setter Property="Opacity"
                                        Value="0.6" />
                                <Setter Property="Foreground"
                                        Value="Gray" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>

                <DataGrid.Columns>
                    <DataGridTextColumn Header="Title"
                                        Binding="{Binding Title}"
                                        Width="*" />
                    <DataGridTextColumn Header="Hotel"
                                        Binding="{Binding HotelName}"
                                        Width="220" />
                    <DataGridTextColumn Header="Start"
                                        Binding="{Binding StartDate, StringFormat=dd/MM/yyyy}"
                                        Width="110" />
                    <DataGridTextColumn Header="End"
                                        Binding="{Binding EndDate,   StringFormat=dd/MM/yyyy}"
                                        Width="110" />
                    <DataGridTextColumn Header="Option"
                                        Binding="{Binding OptionDueDate, StringFormat=dd/MM/yyyy}"
                                        Width="110" />
                    <DataGridTextColumn Header="Remain"
                                        Binding="{Binding RemainingTotal}"
                                        Width="90" />
                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}"
                                        Width="120" />
                </DataGrid.Columns>
            </DataGrid>

            <GridSplitter Grid.Column="1"
                          Width="12" />

            <!-- Detail editor -->
            <Border Grid.Column="2"
                    Padding="12"
                    BorderBrush="#DDD"
                    BorderThickness="1"
                    CornerRadius="6">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="120" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!-- Actions -->
                    <StackPanel Grid.Row="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <Button Content="Add New"
                                Command="{Binding BeginNewCommand}"
                                Style="{StaticResource FormControl}" />
                        <Button Content="Edit"
                                Command="{Binding BeginEditCommand}"
                                IsEnabled="{Binding CanEdit}"
                                Style="{StaticResource FormControl}" />
                        <Button Content="Save"
                                Command="{Binding SaveCommand}"
                                IsEnabled="{Binding IsEditing}"
                                Style="{StaticResource FormControl}" />
                        <Button Content="Cancel"
                                Command="{Binding CancelCommand}"
                                IsEnabled="{Binding IsEditing}"
                                Style="{StaticResource FormControl}" />
                        <Button Content="Delete"
                                Command="{Binding DeleteCommand}"
                                IsEnabled="{Binding CanDelete}"
                                Style="{StaticResource FormControl}" />
                    </StackPanel>

                    <TextBlock Grid.Row="1"
                               Grid.ColumnSpan="2"
                               Text="{Binding EditorTitle}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,12" />

                    <!-- Fields -->
                    <TextBlock Grid.Row="2"
                               Grid.Column="0"
                               Text="Title"
                               FontWeight="SemiBold"
                               Margin="0,0,8,8" />
                    <TextBox   Grid.Row="2"
                               Grid.Column="1"
                               Text="{Binding EditTitle}"
                               IsEnabled="{Binding IsEditing}"
                               Margin="0,0,0,8" />

                    <TextBlock Grid.Row="3"
                               Grid.Column="0"
                               Text="Hotel"
                               FontWeight="SemiBold"
                               Margin="0,0,8,8" />
                    <ComboBox  Grid.Row="3"
                               Grid.Column="1"
                               ItemsSource="{Binding Hotels}"
                               DisplayMemberPath="Name"
                               SelectedItem="{Binding EditHotel}"
                               IsEnabled="{Binding IsEditing}"
                               Margin="0,0,0,8" />

                    <TextBlock Grid.Row="4"
                               Grid.Column="0"
                               Text="Start / End"
                               FontWeight="SemiBold"
                               Margin="0,0,8,8" />
                    <StackPanel Grid.Row="4"
                                Grid.Column="1"
                                Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <DatePicker SelectedDate="{Binding EditStartDate}"
                                    IsEnabled="{Binding IsEditing}"
                                    Margin="0,0,8,0" />
                        <DatePicker SelectedDate="{Binding EditEndDate}"
                                    IsEnabled="{Binding IsEditing}" />
                    </StackPanel>

                    <TextBlock Grid.Row="5"
                               Grid.Column="0"
                               Text="Option Due"
                               FontWeight="SemiBold"
                               Margin="0,0,8,8" />
                    <DatePicker Grid.Row="5"
                                Grid.Column="1"
                                SelectedDate="{Binding EditOptionDue}"
                                IsEnabled="{Binding IsEditing}"
                                Margin="0,0,0,8" />

                    <TextBlock Grid.Row="6"
                               Grid.Column="0"
                               Text="Status"
                               FontWeight="SemiBold"
                               Margin="0,0,8,8" />
                    <ComboBox  Grid.Row="6"
                               Grid.Column="1"
                               ItemsSource="{Binding Statuses}"
                               SelectedItem="{Binding EditStatus}"
                               IsEnabled="{Binding IsEditing}"
                               Margin="0,0,0,8" />

                    <TextBlock Grid.Row="7"
                               Grid.Column="0"
                               Text="Notes"
                               FontWeight="SemiBold"
                               Margin="0,0,8,8" />
                    <TextBox   Grid.Row="7"
                               Grid.Column="1"
                               Text="{Binding EditNotes}"
                               IsEnabled="{Binding IsEditing}"
                               AcceptsReturn="True"
                               TextWrapping="Wrap"
                               MinHeight="60"
                               Margin="0,0,0,8" />

                    <!-- Lines area -->
                    <StackPanel Grid.Row="8"
                                Grid.ColumnSpan="2">
                        <TextBlock Text="Room Types / Lines"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,6" />

                        <DataGrid ItemsSource="{Binding Lines}"
                                  SelectedItem="{Binding SelectedLine}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  Height="240"
                                  Margin="0,0,0,8">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Room Type"
                                                    Binding="{Binding RoomType.Name}"
                                                    Width="*" />
                                <DataGridTextColumn Header="Total"
                                                    Binding="{Binding QuantityTotal}"
                                                    Width="80" />
                                <DataGridTextColumn Header="Sold"
                                                    Binding="{Binding Sold}"
                                                    Width="80" />
                                <DataGridTextColumn Header="Cancelled"
                                                    Binding="{Binding QuantityCancelled}"
                                                    Width="100" />
                                <DataGridTextColumn Header="Remain"
                                                    Binding="{Binding Remaining}"
                                                    Width="90" />
                                <DataGridTextColumn Header="Price/N"
                                                    Binding="{Binding PricePerNight, StringFormat={}{0:0.##}}"
                                                    Width="100" />
                                <DataGridTextColumn Header="Curr."
                                                    Binding="{Binding Currency}"
                                                    Width="70" />
                            </DataGrid.Columns>
                        </DataGrid>

                        <!-- Line editor -->
                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="220" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="120" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="80" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Room Type"
                                       Style="{StaticResource FormLabel}" />
                            <ComboBox  Grid.Column="1"
                                       ItemsSource="{Binding AllRoomTypes}"
                                       DisplayMemberPath="Name"
                                       SelectedItem="{Binding LineRoomType}"
                                       IsEnabled="{Binding IsEditing}" />

                            <TextBlock Grid.Column="3"
                                       Text="Total Qty"
                                       Style="{StaticResource FormLabel}" />
                            <TextBox   Grid.Column="4"
                                       Text="{Binding LineTotalQty}"
                                       IsEnabled="{Binding IsEditing}" />

                            <TextBlock Grid.Column="6"
                                       Text="Price/Night"
                                       Style="{StaticResource FormLabel}" />
                            <TextBox   Grid.Column="7"
                                       Text="{Binding LinePrice}"
                                       IsEnabled="{Binding IsEditing}" />

                            <TextBlock Grid.Column="9"
                                       Text="Currency"
                                       Style="{StaticResource FormLabel}" />
                            <TextBox   Grid.Column="10"
                                       Text="{Binding LineCurrency}"
                                       IsEnabled="{Binding IsEditing}" />
                        </Grid>

                        <StackPanel Orientation="Horizontal"
                                    Margin="0,0,0,8">
                            <Button Content="Add / Update Line"
                                    Command="{Binding UpsertLineCommand}"
                                    IsEnabled="{Binding IsEditing}"
                                    Style="{StaticResource FormControl}" />
                            <Button Content="Remove Line"
                                    Command="{Binding RemoveLineCommand}"
                                    IsEnabled="{Binding IsEditing}"
                                    Style="{StaticResource FormControl}"
                                    Margin="8,0,0,0" />
                        </StackPanel>

                        <!-- Cancel units -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="100" />
                                <ColumnDefinition Width="12" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBlock Grid.Column="0"
                                       Text="Cancel units"
                                       Style="{StaticResource FormLabel}" />
                            <TextBox   Grid.Column="1"
                                       Text="{Binding LineCancelQty}"
                                       IsEnabled="{Binding IsEditing}" />

                            <Button Grid.Column="3"
                                    Content="Cancel N"
                                    Command="{Binding CancelUnitsCommand}"
                                    IsEnabled="{Binding IsEditing}"
                                    Style="{StaticResource FormControl}" />
                        </Grid>

                        <StackPanel Orientation="Horizontal"
                                    Margin="0,8,0,0">
                            <Button Content="Cancel Remaining"
                                    Command="{Binding CancelRemainingCommand}"
                                    IsEnabled="{Binding IsEditing}"
                                    Style="{StaticResource FormControl}" />
                        </StackPanel>

                        <TextBlock Text="{Binding EditorHint}"
                                   Foreground="Gray"
                                   Margin="0,8,0,0" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</UserControl>
