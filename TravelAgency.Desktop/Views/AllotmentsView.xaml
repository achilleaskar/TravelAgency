<UserControl x:Class="TravelAgency.Desktop.Views.AllotmentsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">
    <DockPanel>
        <!-- Toolbar -->
        <Grid DockPanel.Dock="Top"
              Margin="8,6,8,6">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="220" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="160" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Grid.Column="0"
                       Text="Search"
                       Style="{StaticResource FormLabel}" />
            <TextBox   Grid.Column="1"
                       Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                       Style="{StaticResource FormControl}" />
            <TextBlock Grid.Column="3"
                       Text="Hotel"
                       Style="{StaticResource FormLabel}" />
            <ComboBox  Grid.Column="4"
                       ItemsSource="{Binding Hotels}"
                       DisplayMemberPath="Name"
                       SelectedItem="{Binding FilterHotel}"
                       Style="{StaticResource FormControl}" />
            <TextBlock Grid.Column="6"
                       Text="Status"
                       Style="{StaticResource FormLabel}" />
            <ComboBox  Grid.Column="7"
                       ItemsSource="{Binding Statuses}"
                       SelectedItem="{Binding FilterStatus}"
                       Style="{StaticResource FormControl}" />
            <Button Grid.Column="9"
                    Content="Refresh"
                    Command="{Binding LoadCommand}"
                    Style="{StaticResource FormControl}" />
        </Grid>
        <!-- Master / Detail -->
        <Grid Margin="8">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="4*" />
                <ColumnDefinition Width="12" />
                <ColumnDefinition Width="3*" />
            </Grid.ColumnDefinitions>
            <!-- Master list -->
            <DataGrid Grid.Column="0"
                      ItemsSource="{Binding Allotments}"
                      SelectedItem="{Binding Selected}"
                      AutoGenerateColumns="False"
                      IsReadOnly="True"
                      MouseDoubleClick="AllotmentsGrid_MouseDoubleClick">
                <DataGrid.RowStyle>
                    <Style TargetType="DataGridRow">
                        <Style.Triggers>
                            <DataTrigger Binding="{Binding RemainingTotal}"
                                         Value="0">
                                <Setter Property="Opacity"
                                        Value="0.6" />
                                <Setter Property="Foreground"
                                        Value="Gray" />
                            </DataTrigger>
                        </Style.Triggers>
                    </Style>
                </DataGrid.RowStyle>
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Title"
                                        Binding="{Binding Title}"
                                        Width="*" />
                    <DataGridTextColumn Header="Hotel"
                                        Binding="{Binding HotelName}"
                                        Width="120" />
                    <DataGridTextColumn Header="From"
                                        Binding="{Binding StartDate, StringFormat=dd/MM/yyyy}"
                                        Width="110" />
                    <DataGridTextColumn Header="To"
                                        Binding="{Binding EndDate,   StringFormat=dd/MM/yyyy}"
                                        Width="100" />
                    <DataGridTextColumn Header="Option"
                                        Binding="{Binding OptionDueDate, StringFormat=dd/MM/yyyy}"
                                        Width="100" />
                    <DataGridTextColumn Header="Remain"
                                        Binding="{Binding RemainingTotal}"
                                        Width="70" />
                    <DataGridTextColumn Header="Status"
                                        Binding="{Binding Status}"
                                        Width="80" />
                </DataGrid.Columns>
            </DataGrid>
            <GridSplitter Grid.Column="1"
                          Width="12" />
            <!-- Detail: read-only -->
            <Border Grid.Column="2"
                    Padding="12"
                    BorderBrush="#DDD"
                    BorderThickness="1"
                    CornerRadius="6">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <!-- Actions -->
                        <RowDefinition Height="Auto" />
                        <!-- Title -->
                        <RowDefinition Height="Auto" />
                        <!-- Hotel -->
                        <RowDefinition Height="Auto" />
                        <!-- Dates -->
                        <RowDefinition Height="Auto" />
                        <!-- Option -->
                        <RowDefinition Height="Auto" />
                        <!-- Status -->
                        <RowDefinition Height="Auto" />
                        <!-- Notes -->
                        <RowDefinition Height="*" />
                        <!-- Lines -->
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="140" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>
                    <!-- Actions (back) -->
                    <StackPanel Grid.Row="0"
                                Grid.ColumnSpan="2"
                                Orientation="Horizontal"
                                Margin="0,0,0,8">
                        <Button Content="Add New"
                                Command="{Binding OpenNewDialogCommand}"
                                Style="{StaticResource FormControl}" />
                        <Button Content="Edit"
                                Command="{Binding OpenEditDialogCommand}"
                                IsEnabled="{Binding CanEdit}"
                                Style="{StaticResource FormControl}"
                                Margin="8,0,0,0" />
                        <Button Content="Delete"
                                Command="{Binding DeleteCommand}"
                                IsEnabled="{Binding CanDelete}"
                                Style="{StaticResource FormControl}"
                                Margin="8,0,0,0" />
                    </StackPanel>
                    <!-- Header -->
                    <TextBlock Grid.Row="1"
                               Grid.ColumnSpan="2"
                               Text="{Binding Selected.Title}"
                               FontSize="16"
                               FontWeight="SemiBold"
                               Margin="0,0,0,10" />
                    <!-- Hotel -->
                    <TextBlock Grid.Row="2"
                               Grid.Column="0"
                               Text="Hotel"
                               Style="{StaticResource FormLabel}" />
                    <TextBlock Grid.Row="2"
                               Grid.Column="1"
                               Text="{Binding Selected.HotelName}" />
                    <!-- Dates -->
                    <TextBlock Grid.Row="3"
                               Grid.Column="0"
                               Text="From / To"
                               Style="{StaticResource FormLabel}" />
                    <TextBlock Grid.Row="3"
                               Grid.Column="1"
                               Text="{Binding Selected.DateRangeShort}" />
                    <!-- Option Due -->
                    <TextBlock Grid.Row="4"
                               Grid.Column="0"
                               Text="Option Due"
                               Style="{StaticResource FormLabel}" />
                    <TextBlock Grid.Row="4"
                               Grid.Column="1"
                               Text="{Binding Selected.OptionDueDate, StringFormat=dd/MM/yyyy}" />
                    <!-- Status -->
                    <TextBlock Grid.Row="5"
                               Grid.Column="0"
                               Text="Status"
                               Style="{StaticResource FormLabel}" />
                    <TextBlock Grid.Row="5"
                               Grid.Column="1"
                               Text="{Binding Selected.Status}" />
                    <!-- Notes -->
                    <TextBlock Grid.Row="6"
                               Grid.Column="0"
                               Text="Notes"
                               Style="{StaticResource FormLabel}" />
                    <ScrollViewer Grid.Row="6"
                                  Grid.Column="1"
                                  VerticalScrollBarVisibility="Auto"
                                  Height="80">
                        <TextBlock Text="{Binding Selected.Notes}"
                                   TextWrapping="Wrap" />
                    </ScrollViewer>
                    <!-- Lines (bind to Selected.Lines for read-only details) -->
                    <StackPanel Grid.Row="7"
                                Grid.ColumnSpan="2"
                                Margin="0,10,0,0">
                        <TextBlock Text="Room Types / Lines"
                                   FontWeight="SemiBold"
                                   Margin="0,0,0,6" />
                        <DataGrid ItemsSource="{Binding Selected.Lines}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  IsReadOnly="True"
                                  Height="260">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Room Type"
                                                    Binding="{Binding RoomType.Name}"
                                                    Width="*" />
                                <DataGridTextColumn Header="Total"
                                                    Binding="{Binding QuantityTotal}"
                                                    Width="80" />
                                <DataGridTextColumn Header="Sold"
                                                    Binding="{Binding Sold}"
                                                    Width="80" />
                                <DataGridTextColumn Header="Cancelled"
                                                    Binding="{Binding QuantityCancelled}"
                                                    Width="100" />
                                <DataGridTextColumn Header="Remain"
                                                    Binding="{Binding Remaining}"
                                                    Width="90" />
                                <DataGridTextColumn Header="Price/N"
                                                    Binding="{Binding PricePerNight, StringFormat={}{0:0.##}}"
                                                    Width="100" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</UserControl>
